<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <link rel="stylesheet" href="style.css" type="text/css"/>
          <!-- Librairie Javascript: jQuery (v3.4.1) -->
           <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
         <style type="text/css">
            h1 { text-align: center; }
            .highcharts-container {
                max-width: 800px;
                height: 400px;
                margin: 1em auto;
            }
        </style>
    </head>
    <body>
        
        
        <header > 
            <img  src="image/logo.png" alt="logo du site" id="logo" >
            <h1>  </h1> 
             <button id="boutonDeconnexion">Se déconnecter</button>
            
            </header>     
        
         <p id="notification"></p>
        <button id="RefreshDemande">Rafraîchir les demandes de Consultation</button>
        
        <div id="consultationOrNot">
             <!-- Faudra afficher la consultation demander ici -->
             <div id="consult">
                 
                <p id="infosConsult"></p>
                
                
                 
                    
                         <p> Demande de consultation pour : </p>
                    
                   
                        
                        
                         <!-- tableau qui va afficher le client -->
                    <table style="width:100%">
                        <tr>
                            <th>
                                <p class="client_Nom">  </p>
                            </th> 
                            
                            <th>
                                <p class="client_Genre">  </p>
                            </th>
                            <th>
                             <p class="client_num_tel">  </p>
                             </th>
                         </tr>
                        <tr>
                            <th>
                                <p class="client_mail">  </p> 
                            </th> 
                            <th>
                                <p class="client_adresse">  </p> 
                            </th>
                        </tr>

                    </table><!-- comment -->
                   
                     
                     
                         <p> Le client souhaite consulter le médium suivant : </p>
                     
                     
                     
                        
                        
                         <!-- tableau qui va afficher le medium -->
                    <table style="width:100%">
                         <tr>
                            <th>
                                <p class="Medium_Nom">  </p>
                            </th> 
                            
                            <th>
                                <p class="Medium_Genre">  </p>
                            </th>
                            
                         </tr>
                        <tr>
                            <th>
                                <p class="Medium_presentation">  </p> 
                            </th> 
                           
                        </tr>

                    </table><!-- comment -->
                   
                
                
                
                
                
                 
             </div>
             
           <button id="boutonConsultation">Je suis prêt pour démarrer</button>
           
         
        </div>
         
         
         
             
             
             <div id="chercheMediumClient">
            <table style="width:100%">
                <tr>
                    <th>
                        <p> Trouvez les informations concernant un médium </p>

                        <input type="text" id="champ-denomination" size="40" placeholder="Rentrez sa dénomination" />
                        <button id="boutoncherchermedium">Rechercher</button>
                    </th>
                    <th>
                        <p> Trouvez les informations concernant un client </p>
                        <input type="text" id="champ-prenomclient" size="40" placeholder="Rentrez son Prenom" />
                        <input type="text" id="champ-nomclient" size="40" placeholder="Rentrez son nom" />
                           <button id="boutonchercherclient">Rechercher</button>
                    </th>
                </tr>
                <tr>
                    <th>
                        <p id = "mediumTr">Afficher ici le medium</p>
                    </th>
                    <th>
                        <p id = "clientTr">Afficher ici le client</p>
                    </th>
                </tr>
            </table>
        <br/> 
        </div>
             
             
             
             
         
         
         
         
         
         
         
         <div class="BandeauStat">
             <h3>Suivez l’activité de PREDICT’IF</h3>
            </div>
             
        <div id="container-5" class="highcharts-container"></div>
         
        
        
        
        
        
        
        
        <script>
            
            
            function obetnirinfoemp() { 
         // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'obtenirInfoUser'
                           
                            
                        },
                        dataType: 'json'
                    }).done( function (response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response',response); // LOG dans Console Javascript
                        if (response.connexion) {
                            $('h1').html("Bonjour "+response.user.infos.Prenom);
                   
                         }
                      
                        else {
                            $('#notification').html("Erreur de Connexion aux données"); // Message pour le paragraphe de notification
                        }
                    })
                    .fail( function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                        console.log('Error',error); // LOG dans Console Javascript
                        alert("Erreur lors de l'appel AJAX");
                    })
                    .always( function () { // Fonction toujours appelée
                        
                    });
                    
    }
    
    
    
    $('#boutoncherchermedium').on( 'click', function () {
                   $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'chercherMediumDenomination',
                            denomination: $('#champ-denomination').val()
                        },
                        dataType: 'json'
                    }).done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response', response); // LOG dans Console Javascript
                        
                        if (response.succes) {  
                            $('#mediumTr').html(response.medium.infos.denomination);
                        } else {
                            $('#mediumTr').html("Le medium sasi n'existe pas, veuillez ressayer"); // Message pour le paragraphe de notification
                        }
                     

                    }).fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                        console.log('Error', error); // LOG dans Console Javascript
                        alert("Erreur lors de l'appel AJAX");
                    }).always(function () { // Fonction toujours appelée

                    });
                });
                  
                  $('#RefreshDemande').on( 'click', function () {
                   $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'RefreshDemandeconsult'
                           


                        },
                        dataType: 'json'
                    }).done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response', response); // LOG dans Console Javascript
                        
                  if (response.succes) {  
                      
                      $('#consultationOrNot').css("display","block"); 
                      var medium=response.medium;
                      var client=response.client;
                      $(".client_Nom").html(client.Prenom+" "+client.nom );
                      $(".client_Genre").html(" Genre : "+client.genre );
                      $(".client_num_tel").html(" tel : "+client.numTel );
                      $(".client_mail").html(" mail: "+client.mail );
                      $(".client_adresse").html(+client.adressePostal );
                      
                      $(".Medium_Nom").html(medium.denomination+" , " +medium.type );
                      $(".Medium_Genre").html("Genre :"+medium.genre );
                      $(".Medium_presentation").html("Description : "+medium.presentation ); 
                      
                      

                     } else {
                         $('#notification').html("Pas de consultations en attente"); // Message pour le paragraphe de notification
                     }
                     

                    
                            }).fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                                console.log('Error', error); // LOG dans Console Javascript
                                alert("Erreur lors de l'appel AJAX");
                            })
                            .always(function () { // Fonction toujours appelée

                            });
                  });
    
    
    
    
    
     var proportionChartData;
            function obtenirTop3() {


                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'obtenirTop3'

                    },
                    dataType: 'json'
                }).done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                    console.log('Response', response); // LOG dans Console Javascript
                    if (response.succes) {

                        
                        var Medium1 = response.top3[0];
                        var medium1Nom = Medium1.denomination;
                        var medium1Type = Medium1.type;
                        var medium1NbConsult = Medium1.nbConsultations;


                        var Medium2 = response.top3[1];
                        var medium2Nom = Medium2.denomination;
                        var medium2Type = Medium2.type;
                        var medium2NbConsult = Medium2.nbConsultations;

                        var Medium3 = response.top3[2];
                        var medium3Nom = Medium3.denomination;
                        var medium3Type = Medium3.type;
                        var medium3NbConsult = Medium3.nbConsultations;


                        proportionChartData = {
                            label: 'Nombre de consultations',
                            data: [

                                {
                                    name: medium1Nom+" ("+medium1Type+")",
                                    y: medium1NbConsult
                                },
                                {
                                    name: medium2Nom+" ("+medium2Type+")",
                                    y: medium2NbConsult
                                },
                                {
                                    name: medium3Nom+" ("+medium3Type+")",
                                    y: medium3NbConsult
                                }]
                        };
                         console.log('Respons222222',proportionChartData);
                        buildPieChart('container-5', proportionChartData);
                   
        
                    }


                }).fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                    console.log('Error', error); // LOG dans Console Javascript
                    alert("Erreur lors de l'appel AJAX");
                })
                        .always(function () { // Fonction toujours appelée

                        });



            }
            

            function buildPieChart(container, graphData) {

                Highcharts.chart(container, {

                    chart: {
                        type: 'pie'
                    },
                    title: {
                        text: 'Top 3 des médiums'
                    },
                    subtitle: {
                        text: '(en nombre de consultations)'
                    },
                    credits: {
                        enabled: false
                    },
                    series: [{name: graphData.label, data: graphData.data}]
                });
            }

    
    
    
    
    
    
    
    
    
    
    
          $(document).ready( function () {
              obetnirinfoemp();
              obtenirTop3();
          
             $('#boutonDeconnexion').on( 'click', function () {
                   window.location = './login.html';
                  });
        
        
           $('#boutonConsultation').on( 'click', function () {
               
               //ici je dois appele le service demarer consultation
               
                 $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'DemarrerConsult'
                        },
                        dataType: 'json'
                    }).done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response', response); // LOG dans Console Javascript
                        if (response.succes) {
                       window.location = './PageConsultation.html';
                        } else {
                            $('#notification').html("Erreur de démarrage de la consultation"); // Message pour le paragraphe de notification
                        }
                    })
                            .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                                console.log('Error', error); // LOG dans Console Javascript
                                alert("Erreur lors de l'appel AJAX");
                            })
                            .always(function () { // Fonction toujours appelée

                            });
 
                   
                  });
        // Appelé à la fin du chargement de la page HTML initDonneesPage(); // Appel de la fonction pour initialiser les données de la page
});


        </script>
        
    </body>
</html>
